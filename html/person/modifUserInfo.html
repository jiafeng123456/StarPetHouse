<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>修改信息</title>
  <link rel="stylesheet" type="text/css" href="../../static/css/global.css">
  <link rel="stylesheet" type="text/css" href="../../layui-v2.5.6/css/layui.css">
  <script type="text/javascript" src="../../layui-v2.5.6/layui.js"></script>
  <script src="../../static/js/index/index.js" type="text/javascript"></script>
  <script src="../../static/js/index/freezeheader.js" type="text/javascript"></script>
  <script src="../../static/layui-v2.5.6/lay/modules/layer.js" type="text/javascript"></script>
  <script src="../../static/js/index/sliders.js" type="text/javascript"></script>
  <script src="../../static/js/index/html5.js" type="text/javascript"></script>
  <script src="../../static/js/index/article.js" type="text/javascript"></script>
  <script src="../../static/js/lib/jquery.js"></script>
  <script src="../../static/js/lib/jquery-ui.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
</head>
<body>
<div class="layui-header header">
  <div class="layui-form">
    <div class="main">
      <script id="demo" type="text/html">
        <ul class="layui-nav layui-nav-left" lay-filter="filter">
              {{#  layui.each(d.list, function(index, item){ }}
              <li class="layui-nav-item">
                <a href="{{ item.url }}"  target="content">{{ item.name }}</a>
              </li>
              <!-- <a href="{{ item.url }}" target="content">{{ item.name }}</a> -->
              {{#  }); }}
              {{#  if(d.list.length === 0){ }}
              无数据
              {{#  } }}
        </ul>
      </script>
      <div id="view" class="main"></div>
        <ul class="layui-nav layui-layout-right layui-nav-right" lay-filter="filter">
            <li class="layui-nav-item">
                <a href="home.html" target="content">我的主页<span class="layui-badge-dot"></span></a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;"><img src="" id="headImage" class="layui-nav-img">我</a><span class="layui-nav-more"></span>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;" id="modifInfo">修改信息</a></dd>
                    <dd><a href="javascript:;">安全管理</a></dd>
                    <dd><a href="javascript:;" id="logOut">退了</a></dd>
                </dl>
            </li>
        </ul>
      
    </div>
  </div>
</div>
<div style="height: 30px;">
  
</div>
<div class="content">
  <div>
    <div class="layui-row layui-col-space10">
    <div class="layui-col-md1">
      你的内容 1/12
    </div>
    <div class="layui-col-md7">
    <script id="demo1" type="text/html">
    <form class="layui-form" action="">
      <input type="text" hidden name="user_id" value="{{ d.list.user_id }}">
      <div class="layui-form-item">
        <label class="layui-form-label">头像</label>
        <div class="layui-input-block">
            <img class="layui-upload-img" width="100px" height="100px" style="border-radius: 50px" id="img2" src="{{ d.list.user_image_url }}">
            <input type="hidden" name="user_image_url" class="image">
            <div class="layui-upload">
              <button type="button" class="layui-btn" id="test1">上传图片</button>
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">用户名</label>
        <div class="layui-input-block">
            <input type="text" name="user_name" lay-verify="required" lay-reqtext="用户名是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input" readonly="true" value="{{ d.list.user_name }}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">昵称</label>
        <div class="layui-input-block">
            <input type="text" name="name" lay-verify="required" lay-reqtext="昵称是必填项，岂能为空？" placeholder="请输入" autocomplete="off" class="layui-input" value="{{ d.list.name }}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">单选框</label>
        <div class="layui-input-block">
            <input type="radio" name="user_gender" value="0" title="男" {{# if(d.list.user_gender=='0'){ }} checked="" {{# } }}>
            <input type="radio" name="user_gender" value="1" title="女" {{# if(d.list.user_gender=='1'){ }} checked="" {{# } }}>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">年龄</label>
            <div class="layui-input-inline">
                <input type="tel" name="user_age" lay-verify="required" value="{{ d.list.user_age }}" autocomplete="off" class="layui-input" >
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-inline">
                <input type="tel" name="user_mobile_tel" value="{{ d.list.user_mobile_tel }}" lay-verify="required|phone" autocomplete="off" class="layui-input">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">身份证号</label>
        <div class="layui-input-block">
            <input type="text" name="user_id_card" lay-verify="identity" value="{{ d.list.user_id_card }}" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>
     <div class="layui-form-item">
        <label class="layui-form-label">家庭住址</label>
        <div class="layui-input-block">
            <input type="text" name="user_address" value="{{ d.list.user_address }}" placeholder="" autocomplete="off" class="layui-input">
        </div>
    </div>
     <div class="layui-form-item">
        <label class="layui-form-label">个人简介</label>
        <div class="layui-input-block">
            <input type="text" name="memo"  placeholder="" value="{{ d.list.memo }}" autocomplete="off" class="layui-input">
        </div>
    </div>
    
   <div class="layui-form-item">
    <div class="layui-input-block">
      <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>
</script>
<div id="view1" class="main"></div>
    </div>
    <div class="layui-col-md3 ">
      你的内容 2/12
    </div>
    <div class="layui-col-md1">
      你的内容 1/12
    </div>
  </div>
  </div>
  
</div>

<script>
  
  layui.use(['layer','laytpl','jquery','form','layedit', 'laydate','upload'], function(){
      var $ = layui.jquery;
      var laytpl = layui.laytpl;
      var form = layui.form,layedit = layui.layedit
            ,laydate = layui.laydate,upload = layui.upload;;
      var username = getUrlParam("username");
      debugger
      $.ajax({
          type: 'POST',
          data:{username:username},
          url: 'http://127.0.0.1:8088/user/getUserMenu',
          success: function (data) {
            if (data.error_no == "0") {
                var getTpl = demo.innerHTML,
                view = document.getElementById("view");
                laytpl(getTpl).render(data, function(html) {
                  view.innerHTML = html;
                });
                $("#headImage").attr("src",data.image);
                $("#modifInfo").attr("href","../person/modifUserInfo.html?username=" + username);
                $("#logOut").attr("href","../login.html");
                
              }
              
          },
          error:function(){
            url = "../login.html";
            window.location.href = url; 
          }

      });

      $.ajax({
          type: 'POST',
          data:{username:username},
          url: 'http://127.0.0.1:8088/user/getUserInfo',
          success: function (data) {
            if (data.error_no == "0") {
                var getTpl = demo1.innerHTML,
                view1 = document.getElementById("view1");
                laytpl(getTpl).render(data, function(html) {
                  view1.innerHTML = html;
                });
                layui.use('form', function() {
                var form = layui.form; //++只有执行了这一步，部分表单元素才会自动修饰成功
                form.render();
                });
                //普通图片上传
                var uploadInst = upload.render({
                elem: '#test1'
                ,accept:"images"
                ,auto : "true"
                ,url: 'http://127.0.0.1:8088/upload/uploadImage' //改成您自己的上传接口
                ,choose: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                $('#demo1').attr('src', result); //图片链接（base64）
                });
                }
    ,done: function(res){
      //如果上传失败
      if(res.code > 0){
        return layer.msg('上传失败');
      }
          var fileupload = $(".image");
          fileupload.attr("value",res.data.src);
          var fileupload1 = $("#img2");
          fileupload1.attr("src",res.data.src);
          console.log(fileupload.attr("value"));
    }
    ,error: function(){
    
    }
  });
              }
              
          },
          error:function(){
            url = "../login.html";
            window.location.href = url; 
          }

      });

        

           //监听提交
        form.on('submit(demo1)', function(data){
          $.ajax({
          type: 'POST',
          data:data.field,
          url: 'http://127.0.0.1:8088/user/modifyUserInfo',
          success: function (data) {
            if (data.error_no == "0") {
                layer.msg("修改成功");
                
              }else {
                layer.msg("修改失败：" + data.error_info);
              }
              
          },
          error:function(){
            url = "../login.html";
            window.location.href = url; 
          }

          });
          return false;
        });

    function getUrlParam(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
      var r = window.location.search.substr(1).match(reg); //匹配目标参数
      if (r != null) return unescape(r[2]); return null; //返回参数值
    }

  });
</script>


</body>
</html>